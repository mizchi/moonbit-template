# MoonBit Project

This is a [MoonBit](https://docs.moonbitlang.com) project with CLI distribution.

## Quick Commands

```bash
just           # check + test
just fmt       # format code
just check     # type check
just test      # run tests
just test-update  # update snapshot tests
just run 20    # run CLI with args (native)
just build     # build native release binary
just install   # install CLI to ~/.moon/bin
just info      # generate type definition files
```

## Project Structure

- `moon.mod.json` - Module definition
- `moon.pkg` - Package dependencies (per directory)
- `src/` - Library package
- `src/cmd/app/` - CLI executable (`is-main: true`)
- `*.mbt` - Source files
- `*_test.mbt` - Blackbox test files
- `*_wbtest.mbt` - Whitebox test files
- `*.mbt.md` - Doc test files
- `*.mbti` - Generated type interfaces (auto-generated by `moon info`)

## CLI Build

- Build: `moon build --release --target native src/cmd/app`
- Output: `_build/native/release/build/cmd/app/app.exe`
- Install: `moon install ./src/cmd/app`
- Version is defined in `src/cmd/app/main.mbt` and `moon.mod.json`

## Coding Convention

- Each block is separated by `///|`
- Use `moon ide` commands for code navigation (prefer over grep)
- Use `moon doc '<Type>'` to explore APIs before implementing
- MoonBit code uses snake_case for variables/functions (lowercase only)
- UpperCamelCase for types, enums, and enum variants
- `nobreak` (not `else`) for functional for-loop exit values
- No `return` needed — last expression is the return value
- No `try` needed for error propagation — automatic (unlike Swift)
- Type parameter comes after `fn`: `fn[T] foo(x: T) -> T`
- Legacy `function_name!(...)` and `function_name(...)?` are deprecated

## Tooling

- `moon fmt` - format code
- `moon info` - update generated package interfaces (`.mbti`)
- `moon test` - run tests. Use `moon test --update` to update snapshots.
- `moon check --deny-warn` - type check with warnings as errors
- `moon doc '<query>'` - discover APIs (more accurate than grep)
- `moon ide peek-def <Symbol>` - show symbol definition
- `moon ide find-references <Symbol>` - find all references

## Before Commit

```bash
just release-check  # fmt + info + check + test
```
